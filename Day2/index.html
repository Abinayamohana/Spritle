<!-- Async JS: Promises, async/await, chaining - Error handling with try/catch -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async - await</title>
    <style>
        .btn{
            background-color: gray;
            height: 30px;
            cursor: pointer;
            
        }
        .btn:hover{
            background-color: black;
            color: white;

        }

        #userIdInput{
            width: 25%;
            height: 30px;
        }
        #userInfo,#posts,#error{
            margin-top: 20px;
            border-radius:5px ;            
        }
        #userInfo{
            background-color: #f0f8ff;
        }
        #posts{
            background-color: rgb(202, 173, 229);
        }

        #error{
            color: red;
        }
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <div style="text-align: center;">
    <h1>Fetch user Info</h1>

    <input type="number" placeholder="Enter UserId between 1 - 10" id="userIdInput" min="1" /> 
    <button onclick="loadDashboard()" class="btn" id="btn-id">Load Data</button> 

    <div id="spinner" style="display: none; margin-top: 20px; text-align: center;"> 
        <div class="loader"></div>
    </div>

    <div id="userInfo"></div>
    <div id="posts"></div>
    <div id="error"></div>
   </div>
    <script>
        // Add the event listener
        const input = document.getElementById("userIdInput");
        input.addEventListener("keypress", function(event){
            console.log(event)
            if(event.key === "Enter"){
                event.preventDefault();
                document.getElementById("btn-id").click();
            }
        })

        async function fetchUser(userId){
            const response = await fetch (`https://jsonplaceholder.typicode.com/users/${userId}`) //API for the user details
            if(!response.ok) throw new Error("User Not Found.")
            return response.json();
        }

        async function fetchPosts(userId){
            const response = await fetch (`https://jsonplaceholder.typicode.com/posts?userId=${userId}`) //API for the posts
            if(!response.ok) throw new Error("Unable to fetch posts.")
            return response.json();
        }
        
        async function loadDashboard(){
            const userId = document.getElementById("userIdInput").value
            const userInfoDiv = document.getElementById("userInfo")
            const postsDiv = document.getElementById("posts")
            const errorDiv = document.getElementById("error")
            const spinner = document.getElementById("spinner")

            userInfoDiv.innerHTML = "";
            postsDiv.innerHTML = "";
            errorDiv.innerHTML = '';
            spinner.style.display = "block"


            try {
                const user = await fetchUser(userId);
                userInfoDiv.innerHTML = `
                <h3>User Info</h3>
                <p><Strong>User Name:</Strong> ${user.name}</p>
                <p><Strong>User Email:</Strong> ${user.email}</p>
                <p><Strong>User Address:</Strong> ${user.address.city}</p>
                `;

                const posts = await fetchPosts(userId);
                postsDiv.innerHTML = "<h3>Recent Posts</h3>";
                posts.slice(0, 5).forEach(post => {
                postsDiv.innerHTML += `<p><strong>${post.title}</strong><br>${post.body} <hr> </p>`;
               });
            }
            catch(error){
                errorDiv.innerHTML = error.message
              
            }
            finally {
                spinner.style.display = "none"; // Hide spinner
       }
        }

    </script>
    
</body>
</html>